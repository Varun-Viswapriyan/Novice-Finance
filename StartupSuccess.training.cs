﻿// This file was auto-generated by ML.NET Model Builder. 
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers.FastTree;
using Microsoft.ML.Trainers;
using Microsoft.ML.Transforms;
using Microsoft.ML;

namespace WebApplication4
{
    public partial class StartupSuccess
    {
        /// <summary>
        /// Retrains model using the pipeline generated as part of the training process. For more information on how to load data, see aka.ms/loaddata.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <param name="trainData"></param>
        /// <returns></returns>
        public static ITransformer RetrainPipeline(MLContext mlContext, IDataView trainData)
        {
            var pipeline = BuildPipeline(mlContext);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.Categorical.OneHotEncoding(new []{new InputOutputColumnPair(@"Worked in top companies", @"Worked in top companies"),new InputOutputColumnPair(@"Average size of companies worked for in the past", @"Average size of companies worked for in the past"),new InputOutputColumnPair(@"Have been part of successful startups in the past?", @"Have been part of successful startups in the past?"),new InputOutputColumnPair(@"Consulting experience?", @"Consulting experience?"),new InputOutputColumnPair(@"Product or service company?", @"Product or service company?"),new InputOutputColumnPair(@"Focus on private or public data?", @"Focus on private or public data?"),new InputOutputColumnPair(@"Focus on consumer data?", @"Focus on consumer data?"),new InputOutputColumnPair(@"Focus on structured or unstructured data", @"Focus on structured or unstructured data"),new InputOutputColumnPair(@"Subscription based business", @"Subscription based business"),new InputOutputColumnPair(@"Cloud or platform based serive/product?", @"Cloud or platform based serive/product?"),new InputOutputColumnPair(@"Local or global player", @"Local or global player"),new InputOutputColumnPair(@"Linear or Non-linear business model", @"Linear or Non-linear business model"),new InputOutputColumnPair(@"Capital intensive business e.g. e-commerce, Engineering products and operations can also cause a business to be capital intensive", @"Capital intensive business e.g. e-commerce, Engineering products and operations can also cause a business to be capital intensive"),new InputOutputColumnPair(@"Crowdsourcing based business", @"Crowdsourcing based business"),new InputOutputColumnPair(@"Crowdfunding based business", @"Crowdfunding based business"),new InputOutputColumnPair(@"Machine Learning based business", @"Machine Learning based business"),new InputOutputColumnPair(@"Predictive Analytics business", @"Predictive Analytics business"),new InputOutputColumnPair(@"Speech analytics business", @"Speech analytics business"),new InputOutputColumnPair(@"Prescriptive analytics business", @"Prescriptive analytics business"),new InputOutputColumnPair(@"Big Data Business", @"Big Data Business"),new InputOutputColumnPair(@"Cross-Channel Analytics/ marketing channels", @"Cross-Channel Analytics/ marketing channels"),new InputOutputColumnPair(@"Online or offline venture - physical location based business or online venture?", @"Online or offline venture - physical location based business or online venture?"),new InputOutputColumnPair(@"Highest education", @"Highest education"),new InputOutputColumnPair(@"Experience in selling and building products", @"Experience in selling and building products"),new InputOutputColumnPair(@"Dificulty of Obtaining Work force", @"Dificulty of Obtaining Work force"),new InputOutputColumnPair(@"Time to market service or product", @"Time to market service or product"),new InputOutputColumnPair(@"Barriers of entry for the competitors", @"Barriers of entry for the competitors"),new InputOutputColumnPair(@"Gartner hype cycle stage", @"Gartner hype cycle stage")}, outputKind: OneHotEncodingEstimator.OutputKind.Indicator)      
                                    .Append(mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"year of founding", @"year of founding"),new InputOutputColumnPair(@"Number of Investors in Seed", @"Number of Investors in Seed"),new InputOutputColumnPair(@"Number of Co-founders", @"Number of Co-founders"),new InputOutputColumnPair(@"Number of of advisors", @"Number of of advisors"),new InputOutputColumnPair(@"Team size all employees", @"Team size all employees"),new InputOutputColumnPair(@"Number of of repeat investors", @"Number of of repeat investors"),new InputOutputColumnPair(@"Number of Direct competitors", @"Number of Direct competitors"),new InputOutputColumnPair(@"Time to 1st investment (in months)", @"Time to 1st investment (in months)"),new InputOutputColumnPair(@"Avg time to investment - average across all rounds, measured from previous investment", @"Avg time to investment - average across all rounds, measured from previous investment")}))      
                                    .Append(mlContext.Transforms.Text.FeaturizeText(inputColumnName:@"Last round of funding received (in milionUSD)",outputColumnName:@"Last round of funding received (in milionUSD)"))      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"Worked in top companies",@"Average size of companies worked for in the past",@"Have been part of successful startups in the past?",@"Consulting experience?",@"Product or service company?",@"Focus on private or public data?",@"Focus on consumer data?",@"Focus on structured or unstructured data",@"Subscription based business",@"Cloud or platform based serive/product?",@"Local or global player",@"Linear or Non-linear business model",@"Capital intensive business e.g. e-commerce, Engineering products and operations can also cause a business to be capital intensive",@"Crowdsourcing based business",@"Crowdfunding based business",@"Machine Learning based business",@"Predictive Analytics business",@"Speech analytics business",@"Prescriptive analytics business",@"Big Data Business",@"Cross-Channel Analytics/ marketing channels",@"Online or offline venture - physical location based business or online venture?",@"Highest education",@"Experience in selling and building products",@"Dificulty of Obtaining Work force",@"Time to market service or product",@"Barriers of entry for the competitors",@"Gartner hype cycle stage",@"year of founding",@"Number of Investors in Seed",@"Number of Co-founders",@"Number of of advisors",@"Team size all employees",@"Number of of repeat investors",@"Number of Direct competitors",@"Time to 1st investment (in months)",@"Avg time to investment - average across all rounds, measured from previous investment",@"Last round of funding received (in milionUSD)"}))      
                                    .Append(mlContext.Regression.Trainers.FastForest(new FastForestRegressionTrainer.Options(){NumberOfTrees=4,NumberOfLeaves=4,FeatureFraction=1F,LabelColumnName=@"Dependent-Company Status",FeatureColumnName=@"Features"}));

            return pipeline;
        }
    }
}
